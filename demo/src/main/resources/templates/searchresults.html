<!DOCTYPE html>
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>搜索结果</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <style>
    .table {
      font-size: 10px; /* 调整表格字体大小 */
    }
    .btn-spacing {
      margin-right: 10px; /* 调整按钮之间的间距 */
    }
  </style>
</head>
<body>
<div class="container mt-5">
  <h1>Searching results</h1>

  <!-- 显示搜索结果的条数 -->
  <div class="mb-4">
    <h2><span th:text="${resultCount}">0</span> results found</h2>
  </div>

  <!-- 搜索表单 -->
  <div class="mb-4">
    <form action="/test/search2" method="get">
      <div class="form-group">
        <label for="title">Title</label>
        <input type="text" id="title" name="title" class="form-control" th:value="${title}">
      </div>

      <div class="form-group">
        <label for="publisher">Publisher</label>
        <select id="publisher" name="publisher" class="form-control">
          <option value="" th:selected="${publisher == null}">All kinds</option>
          <th:block th:each="pub : ${publishers}">
            <option th:value="${pub}" th:text="${pub}" th:selected="${pub == publisher}"></option>
          </th:block>
        </select>
      </div>

      <div class="form-group">
        <label for="sourceType">Source Type</label>
        <select id="sourceType" name="sourceType" class="form-control">
          <option value="" th:selected="${sourceType == null}">All kinds</option>
          <th:block th:each="type : ${sourceTypes}">
            <option th:value="${type}" th:text="${type}" th:selected="${type == sourceType}"></option>
          </th:block>
        </select>
      </div>

      <div class="form-group">
        <label for="language">Language</label>
        <select id="language" name="language" class="form-control">
          <option value="" th:selected="${language == null}">All kinds</option>
          <th:block th:each="lang : ${languages}">
            <option th:value="${lang}" th:text="${lang}" th:selected="${lang == language}"></option>
          </th:block>
        </select>
      </div>

      <div class="form-group">
        <label for="published">Published</label>
        <select id="published" name="published" class="form-control">
          <option value="" th:selected="${published == null}">All kinds</option>
          <th:block th:each="pubDate : ${publisheds}">
            <option th:value="${pubDate}" th:text="${pubDate}" th:selected="${pubDate == published}"></option>
          </th:block>
        </select>
      </div>

      <div class="form-group">
        <label for="status">Status</label>
        <select id="status" name="status" class="form-control">
          <option value="" th:selected="${status == null}">All kinds</option>
          <th:block th:each="stat : ${statuses}">
            <option th:value="${stat}" th:text="${stat}" th:selected="${stat == status}"></option>
          </th:block>
        </select>
      </div>

      <div class="form-group">
        <label for="databaseId">Database</label>
        <select id="databaseId" name="databaseId" class="form-control">
          <option value="" th:selected="${databaseId == null}">All kinds</option>
          <th:block th:each="entry : ${databaseMap}">
            <option th:value="${entry.key}" th:text="${entry.value}" th:selected="${entry.key == databaseId}"></option>
          </th:block>
        </select>
      </div>

      <button type="submit" class="btn btn-primary">Search</button>
    </form>
  </div>


  <!-- 搜索结果表格 -->
  <table class="table table-striped">
    <thead>
    <tr>
      <th>Title</th>
      <th>Alternate Title</th>
      <th>Source Type</th>
      <th>Authors</th>
      <th>ISBN</th>
      <th>Publisher</th>
      <th>Published</th>
      <th>Status</th>
      <th>Database</th>
      <th>Loan</th>
      <th>Loaned</th>
      <th>Downloadable</th>
      <th>Viewable</th>
      <th>Pdf</th>
      <th>Operate</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="book : ${books}">
      <td th:text="${book.title}">Title</td>
      <td th:text="${book.alternativeTitle}">Alternative Title</td>
      <td th:text="${book.sourceType}">Source Type</td>
      <td th:text="${book.author}">Author</td>
      <td th:text="${book.isbn}">ISBN</td>
      <td th:text="${book.publisher}">Publisher</td>
      <td th:text="${book.published}">Published</td>
      <td>
        <span th:text="${book.status}">Status</span>
        <button class="btn btn-link edit-button"
                th:attr="data-id=${book.id}, data-type='status', data-value=${book.status}"
                onclick="showEditModal(this)">edit</button>
      </td>
      <td th:text="${book.resourcesId}">Resources ID</td>
      <td>
        <span th:text="${book.loanLabel}">Loan Label</span>
        <button class="btn btn-link edit-button"
                th:attr="data-id=${book.id}, data-type='loan', data-value=${book.loanLabel}"
                onclick="showEditModal(this)">edit</button>
      </td>
      <td th:text="${book.loaned}">Loaned</td>
      <td>
        <span th:text="${book.download}">Download</span>
        <button class="btn btn-link edit-button"
                th:attr="data-id=${book.id}, data-type='download', data-value=${book.download}"
                onclick="showEditModal(this)">edit</button>
      </td>
      <td>
        <span th:text="${book.view}">View</span>
        <button class="btn btn-link edit-button"
                th:attr="data-id=${book.id}, data-type='view', data-value=${book.view}"
                onclick="showEditModal(this)">edit</button>
      </td>
      <td>
        <a th:if="${book.downloadLink != null && !book.downloadLink.isEmpty()}" th:href="@{/downloadfiles/{bookId}(bookId=${book.id})}">Download</a>
        <span th:if="${book.downloadLink == null || book.downloadLink.isEmpty()}">Not available</span>
      </td>
      <td>
        <form th:action="@{/test/deleteList/{fileID}(fileID=${book.id})}" method="post" style="display:inline;">
          <input type="hidden" name="title" th:value="${title}">
          <input type="hidden" name="publisher" th:value="${publisher}">
          <input type="hidden" name="sourceType" th:value="${sourceType}">
          <input type="hidden" name="language" th:value="${language}">
          <input type="hidden" name="published" th:value="${published}">
          <input type="hidden" name="status" th:value="${status}">
          <input type="hidden" name="databaseId" th:value="${databaseId}">
          <button type="submit" class="btn btn-danger btn-spacing">delete</button>
        </form>
        <form th:action="@{book/{fileID}(fileID=${book.id})}" method="get" style="display:inline;">
          <input type="hidden" name="title" th:value="${title}">
          <input type="hidden" name="publisher" th:value="${publisher}">
          <input type="hidden" name="sourceType" th:value="${sourceType}">
          <input type="hidden" name="language" th:value="${language}">
          <input type="hidden" name="published" th:value="${published}">
          <input type="hidden" name="status" th:value="${status}">
          <input type="hidden" name="databaseId" th:value="${databaseId}">
          <button type="submit" class="btn btn-success btn-spacing">edit</button>
        </form>
      </td>
    </tr>
    </tbody>
  </table>

  <!-- 返回搜索页面的链接 -->
  <a href="/test/searchPage" class="btn btn-secondary mt-3">返回搜索页面</a>

  <!-- 模态框 -->
  <div class="modal fade" id="editModal" tabindex="-1" aria-labelledby="editModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="editModalLabel">编辑</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
          <form id="editForm" method="post" th:action="@{/test/updateField}">
            <input type="hidden" id="editId" name="id">
            <input type="hidden" id="editType" name="editType">
            <div class="form-group">
              <label for="editField">Value</label>
              <select class="form-control" id="editField" name="editField"></select>
            </div>
            <button type="submit" class="btn btn-primary">Save changes</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

  <!-- 自定义JS -->
  <script>
    function showEditModal(button) {
      var id = button.getAttribute('data-id');
      var type = button.getAttribute('data-type');
      var value = button.getAttribute('data-value');

      $('#editId').val(id);
      $('#editType').val(type);

      var select = $('#editField');
      select.empty();  // Clear existing options

      if (type === 'status') {
        select.append('<option value="published">Published</option>');
        select.append('<option value="hide">Hide</option>');
      } else {
        select.append('<option value="true">True</option>');
        select.append('<option value="false">False</option>');
      }

      select.val(value);  // Set the current value
      $('#editModal').modal('show');
    }
  </script>
</div>
</body>
</html>
